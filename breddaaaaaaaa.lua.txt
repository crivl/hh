-- Original TerminalWare Script Revamped
-- Preserved core functionality with fixes

getgenv().Rake = {
    Settings = {
        Prediction = 0.12,
        JumpOffSet = 0.06,
        AimPart = "Head",
        ToggleKey = "P",
        MenuKey = "Insert",
        AntiGroundShots = true,
        AutoShoot = true
    }
}

-- Improved UI System
local function CreateWatermark()
    local WatermarkGUI = Instance.new("ScreenGui")
    WatermarkGUI.Parent = game.CoreGui
    WatermarkGUI.Name = "TerminalWareWatermark"
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 300, 0, 30)
    Frame.Position = UDim2.new(0.5, -150, 0.02, 0)
    Frame.BackgroundTransparency = 0.7
    Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Frame.Parent = WatermarkGUI
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.Text = "TerminalWare v2 | By ezterminals"
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.Font = Enum.Font.GothamBold
    Label.Parent = Frame
    
    return WatermarkGUI
end

-- Enhanced Target Finding
local function FindNearestEnemy()
    local LocalPlayer = game.Players.LocalPlayer
    local ClosestPlayer, ClosestDistance = nil, math.huge
    
    for _, Player in pairs(game.Players:GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            if Character and Character:FindFirstChild("Humanoid") and Character.Humanoid.Health > 0 then
                local AimPart = Character:FindFirstChild(getgenv().Rake.Settings.AimPart)
                if AimPart then
                    local ScreenPos = workspace.CurrentCamera:WorldToViewportPoint(AimPart.Position)
                    local MousePos = LocalPlayer:GetMouse()
                    local Distance = (Vector2.new(MousePos.X, MousePos.Y) - Vector2.new(ScreenPos.X, ScreenPos.Y)).Magnitude
                    
                    if Distance < ClosestDistance then
                        ClosestPlayer = Player
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end
    
    return ClosestPlayer
end

-- Optimized Highlight System
local CurrentHighlight = nil
local function HighlightTarget(Player)
    if CurrentHighlight then
        CurrentHighlight:Destroy()
    end
    
    if Player and Player.Character then
        local Highlight = Instance.new("Highlight")
        Highlight.FillColor = Color3.new(1, 0, 0)
        Highlight.OutlineColor = Color3.new(0.5, 0, 0)
        Highlight.FillTransparency = 0.5
        Highlight.Parent = Player.Character
        CurrentHighlight = Highlight
    end
end

-- Fixed Silent Aim Core
local mt = getrawmetatable(game)
local oldIndex = mt.__index
setreadonly(mt, false)

local Enabled = true
mt.__index = newcclosure(function(self, key)
    if not checkcaller() and Enabled and self:IsA("Mouse") and key == "Hit" then
        local Target = FindNearestEnemy()
        if Target and Target.Character then
            local AimPart = Target.Character:FindFirstChild(getgenv().Rake.Settings.AimPart)
            if AimPart then
                HighlightTarget(Target)
                return CFrame.new(AimPart.Position + (AimPart.Velocity * getgenv().Rake.Settings.Prediction))
            end
        end
    end
    return oldIndex(self, key)
end)
setreadonly(mt, true)

-- Improved AutoShoot
local function AutoShoot()
    while getgenv().Rake.Settings.AutoShoot do
        local Target = FindNearestEnemy()
        if Target and Target.Character then
            local Tool = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if Tool then
                Tool:Activate()
            end
        end
        task.wait(0.1)
    end
end

-- Keybind Handler
local UIS = game:GetService("UserInputService")
UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    
    if input.KeyCode == Enum.KeyCode[getgenv().Rake.Settings.ToggleKey:upper()] then
        Enabled = not Enabled
        HighlightTarget(Enabled and FindNearestEnemy() or nil)
    end
end)

-- Initialize Systems
CreateWatermark()
if getgenv().Rake.Settings.AutoShoot then
    coroutine.wrap(AutoShoot)()
end

-- Original Credit Notice
warn([[
TerminalWare v2 Loaded
By ezterminals - Original Author
Credits to xora for jump offset system
]])
